@model QUANLYTHUVIEN.Models.TbBlog

@{
    ViewData["Title"] = "Thêm Bài viết";
}

<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Thêm Bài viết mới</h6>
    </div>
    <div class="card-body">
        @if (TempData["Error"] != null)
        {
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="fas fa-exclamation-triangle"></i> @TempData["Error"]
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        }

        <form asp-action="Create" method="post">
            <div class="form-group">
                <label asp-for="Title" class="control-label"></label>
                <input asp-for="Title" class="form-control" />
                <span asp-validation-for="Title" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Alias" class="control-label"></label>
                <input asp-for="Alias" class="form-control" />
                <span asp-validation-for="Alias" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Content" class="control-label"></label>
                <textarea asp-for="Content" class="form-control" rows="10"></textarea>
                <span asp-validation-for="Content" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="AuthorId" class="control-label"></label>
                <select asp-for="AuthorId" class="form-control">
                    <option value="">Chọn tác giả</option>
                    @if (ViewBag.Authors != null)
                    {
                        foreach (var author in ViewBag.Authors as IEnumerable<QUANLYTHUVIEN.Models.User>)
                        {
                            <option value="@author.UserId">@author.Username (@author.FullName)</option>
                        }
                    }
                </select>
                <span asp-validation-for="AuthorId" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Image" class="control-label">Ảnh đại diện</label>
                <div class="input-group">
                    <input asp-for="Image" id="Image" class="form-control" placeholder="Chọn ảnh từ thư viện" readonly />
                    <div class="input-group-append">
                        <button type="button" class="btn btn-outline-secondary" onclick="openImageBrowser('Image', 'images/blog')">
                            <i class="fas fa-folder-open"></i> Chọn ảnh
                        </button>
                    </div>
                </div>
                <small class="form-text text-muted">Chọn ảnh từ thư viện ảnh có sẵn trong wwwroot</small>
                <div class="mt-2">
                    <img id="ImagePreview" src="@Url.Content("~/images/blog/blog-10.jpg")" alt="Preview" style="max-width: 300px; max-height: 200px; border: 1px solid #ddd; border-radius: 4px; display: block;" />
                </div>
                <span asp-validation-for="Image" class="text-danger"></span>
            </div>
            <div class="form-group">
                <div class="form-check">
                    <input asp-for="IsPublished" class="form-check-input" />
                    <label asp-for="IsPublished" class="form-check-label">Xuất bản</label>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Tạo bài viết</button>
            <a href="@Url.Action("Index", "Blog")" class="btn btn-secondary">Quay lại</a>
        </form>
    </div>
</div>

<script>
    // Xử lý preview ảnh khi chọn từ browser
    $(document).ready(function() {
        // Cập nhật preview khi trang load
        updateImagePreview();
        
        // Lắng nghe sự thay đổi của input Image (khi chọn ảnh từ browser)
        $('#Image').on('change', function() {
            updateImagePreview();
        });
    });
    
    function updateImagePreview() {
        const imageValue = $('#Image').val();
        const preview = $('#ImagePreview');
        
        if (imageValue && imageValue.trim() !== '') {
            // Nếu có giá trị, hiển thị ảnh từ wwwroot
            preview.attr('src', '/images/blog/' + imageValue);
            preview.show();
        } else {
            // Nếu không có, hiển thị ảnh mặc định
            preview.attr('src', '@Url.Content("~/images/blog/blog-10.jpg")');
            preview.show();
        }
    }
</script>

